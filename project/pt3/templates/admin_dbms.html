{% extends "base.html" %}

{% block title %}Database Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="dashboard">
        <h2>Database Management System - View, Add & Delete</h2>
        
        {% for table_name, data in tables_data.items() %}
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem;">
                {{ table_name }} Table 
                <span style="background: #3498db; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem; margin-left: 0.5rem;">{{ data|length }} records</span>
            </h3>
            
            <!-- Add Form -->
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                <h4 style="margin-bottom: 0.5rem; color: #2c3e50;">Add New Entry</h4>
                <form method="POST" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; align-items: end;">
                    <input type="hidden" name="action" value="insert">
                    <input type="hidden" name="table" value="{{ table_name }}">
                    
                    {% if table_name == 'Airline' %}
                        <div class="form-group">
                            <label>Name *</label>
                            <input type="text" name="name" required>
                        </div>
                    
                    {% elif table_name == 'Airport' %}
                        <div class="form-group">
                            <label>Airport Code *</label>
                            <input type="text" name="airport_code" maxlength="10" required>
                        </div>
                        <div class="form-group">
                            <label>City *</label>
                            <input type="text" name="city" required>
                        </div>
                        <div class="form-group">
                            <label>Country *</label>
                            <input type="text" name="country" required>
                        </div>
                        <div class="form-group">
                            <label>Type *</label>
                            <select name="airport_type" required>
                                <option value="domestic">Domestic</option>
                                <option value="international">International</option>
                                <option value="both">Both</option>
                            </select>
                        </div>
                    
                    {% elif table_name == 'Airplane' %}
                        <div class="form-group">
                            <label>Airline *</label>
                            <select name="airline_name" required>
                                {% for airline in airlines %}
                                <option value="{{ airline.name }}">{{ airline.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ID Number *</label>
                            <input type="number" name="id_number" required>
                        </div>
                        <div class="form-group">
                            <label>Seats *</label>
                            <input type="number" name="num_seats" required>
                        </div>
                        <div class="form-group">
                            <label>Manufacturer *</label>
                            <input type="text" name="manufacturer" required>
                        </div>
                        <div class="form-group">
                            <label>Age *</label>
                            <input type="number" name="age" required>
                        </div>
                    
                    {% elif table_name == 'Flight' %}
                        <div class="form-group">
                            <label>Airline *</label>
                            <select name="airline_name" required>
                                {% for airline in airlines %}
                                <option value="{{ airline.name }}">{{ airline.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Flight Number *</label>
                            <input type="number" name="flight_number" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Airport *</label>
                            <select name="departure_airport" required>
                                {% for airport in airports %}
                                <option value="{{ airport.airport_code }}">{{ airport.airport_code }} - {{ airport.city }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Departure Date *</label>
                            <input type="date" name="departure_date" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Time *</label>
                            <input type="time" name="departure_time" required>
                        </div>
                        <div class="form-group">
                            <label>Arrival Airport *</label>
                            <select name="arrival_airport" required>
                                {% for airport in airports %}
                                <option value="{{ airport.airport_code }}">{{ airport.airport_code }} - {{ airport.city }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Arrival Date *</label>
                            <input type="date" name="arrival_date" required>
                        </div>
                        <div class="form-group">
                            <label>Arrival Time *</label>
                            <input type="time" name="arrival_time" required>
                        </div>
                        <div class="form-group">
                            <label>Base Price *</label>
                            <input type="number" name="base_price" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select name="status">
                                <option value="on-time">On-time</option>
                                <option value="delayed">Delayed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Airplane ID *</label>
                            <input type="number" name="airplane_id" required>
                        </div>
                    
                    {% elif table_name == 'Customer' %}
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" name="customer_email" required>
                        </div>
                        <div class="form-group">
                            <label>Name *</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Password *</label>
                            <input type="password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label>Building Number</label>
                            <input type="number" name="building_number">
                        </div>
                        <div class="form-group">
                            <label>Street</label>
                            <input type="text" name="street">
                        </div>
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" name="city">
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <input type="text" name="state">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" name="phone_number">
                        </div>
                        <div class="form-group">
                            <label>Passport Number</label>
                            <input type="text" name="passport_number">
                        </div>
                        <div class="form-group">
                            <label>Passport Expiration</label>
                            <input type="date" name="passport_expiration">
                        </div>
                        <div class="form-group">
                            <label>Passport Country</label>
                            <input type="text" name="passport_country">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" name="date_of_birth">
                        </div>
                    
                    {% elif table_name == 'AirlineStaff' %}
                        <div class="form-group">
                            <label>Username *</label>
                            <input type="text" name="username" required>
                        </div>
                        <div class="form-group">
                            <label>Password *</label>
                            <input type="password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label>First Name *</label>
                            <input type="text" name="name_first" required>
                        </div>
                        <div class="form-group">
                            <label>Last Name *</label>
                            <input type="text" name="name_last" required>
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" name="date_of_birth">
                        </div>
                        <div class="form-group">
                            <label>Airline *</label>
                            <select name="airline_name" required>
                                {% for airline in airlines %}
                                <option value="{{ airline.name }}">{{ airline.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" name="email" required>
                        </div>
                    
                    {% elif table_name == 'Ticket' %}
                        <div class="form-group">
                            <label>Customer Email *</label>
                            <select name="customer_email" required>
                                {% for customer in customers %}
                                <option value="{{ customer.customer_email }}">{{ customer.customer_email }} - {{ customer.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Airline *</label>
                            <select name="flight_airline" required>
                                {% for airline in airlines %}
                                <option value="{{ airline.name }}">{{ airline.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Flight Number *</label>
                            <input type="number" name="flight_number" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Date *</label>
                            <input type="date" name="flight_departure_date" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Time *</label>
                            <input type="time" name="flight_departure_time" required>
                        </div>
                        <div class="form-group">
                            <label>Card Type *</label>
                            <select name="card_type" required>
                                <option value="credit">Credit</option>
                                <option value="debit">Debit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Card Number *</label>
                            <input type="text" name="card_number" required>
                        </div>
                        <div class="form-group">
                            <label>Card Name *</label>
                            <input type="text" name="card_name" required>
                        </div>
                        <div class="form-group">
                            <label>Card Expiry (YYYY-MM-DD) *</label>
                            <input type="date" name="card_expiry" required>
                        </div>
                        <div class="form-group">
                            <label>Purchase Date (leave empty for today)</label>
                            <input type="date" name="purchase_date">
                        </div>
                        <div class="form-group">
                            <label>Purchase Time (leave empty for now)</label>
                            <input type="time" name="purchase_time">
                        </div>
                    
                    {% elif table_name == 'Review' %}
                        <div class="form-group">
                            <label>Customer Email *</label>
                            <select name="customer_email" required>
                                {% for customer in customers %}
                                <option value="{{ customer.customer_email }}">{{ customer.customer_email }} - {{ customer.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Airline *</label>
                            <select name="flight_airline" required>
                                {% for airline in airlines %}
                                <option value="{{ airline.name }}">{{ airline.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Flight Number *</label>
                            <input type="number" name="flight_number" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Date *</label>
                            <input type="date" name="flight_departure_date" required>
                        </div>
                        <div class="form-group">
                            <label>Departure Time *</label>
                            <input type="time" name="flight_departure_time" required>
                        </div>
                        <div class="form-group">
                            <label>Rating (1-5) *</label>
                            <input type="number" name="rating" min="1" max="5" required>
                        </div>
                        <div class="form-group">
                            <label>Comment</label>
                            <textarea name="comment" rows="2"></textarea>
                        </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Add Entry</button>
                    </div>
                </form>
            </div>
            
            <!-- Table with Delete Buttons -->
            {% if data %}
            <div style="max-height: 500px; overflow-y: auto; overflow-x: auto;">
                <table class="data-table">
                    <thead style="position: sticky; top: 0; background-color: #2c3e50; color: white; z-index: 10;">
                        <tr>
                            {% for key in data[0].keys() %}
                            <th style="white-space: nowrap; padding: 0.75rem;">{{ key }}</th>
                            {% endfor %}
                            <th style="white-space: nowrap; padding: 0.75rem;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                        <tr>
                            {% for key, value in row.items() %}
                            <td style="white-space: nowrap; font-size: 0.9em;">
                                {% if value is none %}
                                    <span style="color: #999;">NULL</span>
                                {% elif value is string and value|length > 50 %}
                                    <span title="{{ value }}" style="cursor: help;">{{ value[:50] }}...</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                            {% endfor %}
                            <td>
                                <form method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this entry?');">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="table" value="{{ table_name }}">
                                    
                                    {% if table_name == 'Airline' %}
                                        <input type="hidden" name="name" value="{{ row.name }}">
                                    {% elif table_name == 'Airport' %}
                                        <input type="hidden" name="airport_code" value="{{ row.airport_code }}">
                                    {% elif table_name == 'Airplane' %}
                                        <input type="hidden" name="airline_name" value="{{ row.airline_name }}">
                                        <input type="hidden" name="id_number" value="{{ row.id_number }}">
                                    {% elif table_name == 'Flight' %}
                                        <input type="hidden" name="airline_name" value="{{ row.airline_name }}">
                                        <input type="hidden" name="flight_number" value="{{ row.flight_number }}">
                                        <input type="hidden" name="departure_date" value="{{ row.departure_date }}">
                                        <input type="hidden" name="departure_time" value="{{ row.departure_time }}">
                                    {% elif table_name == 'Customer' %}
                                        <input type="hidden" name="customer_email" value="{{ row.customer_email }}">
                                    {% elif table_name == 'AirlineStaff' %}
                                        <input type="hidden" name="username" value="{{ row.username }}">
                                    {% elif table_name == 'Ticket' %}
                                        <input type="hidden" name="ticket_id" value="{{ row.ticket_id }}">
                                    {% elif table_name == 'Review' %}
                                        <input type="hidden" name="customer_email" value="{{ row.customer_email }}">
                                        <input type="hidden" name="flight_airline" value="{{ row.flight_airline }}">
                                        <input type="hidden" name="flight_number" value="{{ row.flight_number }}">
                                        <input type="hidden" name="flight_departure_date" value="{{ row.flight_departure_date }}">
                                        <input type="hidden" name="flight_departure_time" value="{{ row.flight_departure_time }}">
                                    {% endif %}
                                    
                                    <button type="submit" class="btn btn-small" style="background-color: #e74c3c; padding: 0.25rem 0.5rem; font-size: 0.8rem;">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p style="color: #666; padding: 1rem;">No data in this table.</p>
            {% endif %}
        </div>
        {% endfor %}
        
        <div style="margin-top: 2rem; text-align: center;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Home</a>
        </div>
    </div>
</div>
{% endblock %}
